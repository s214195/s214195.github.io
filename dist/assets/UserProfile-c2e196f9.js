import{j as B,r as d,l as P,g as F,m as Q,o as n,c as i,b as e,n as N,w as p,v,F as I,k as M,h as w,t as m,q as V,x as Y}from"./index-41b9bd8d.js";import{g as D,a as $,R as z,b as H,_ as O,d as W,y as G,c as R,Q as J}from"./index.esm2017-95bb9d13.js";import{d as k}from"./firebaseInit-5a5e73f0.js";const K={class:"container"},X={class:"row"},Z={class:"col-md-6"},ee=e("h1",{class:"mb-3"},"User Information",-1),te={class:"card"},se={class:"card-body"},oe={class:"mb-3"},ae=["src"],le=["onSubmit"],ne={class:"mb-3"},ie=e("label",{class:"form-label"},"Name:",-1),ce={class:"mb-3"},de=e("label",{class:"form-label"},"Surname:",-1),re={class:"mb-3"},ue=e("label",{class:"form-label"},"Age:",-1),me={class:"mb-3"},pe=e("label",{class:"form-label"},"Email:",-1),ve={class:"mb-3"},_e=e("label",{class:"form-label"},"City:",-1),he=e("button",{type:"submit",class:"btn btn-primary"},"Update",-1),fe={class:"col-md-6"},be=e("h1",{class:"mb-3"},"Your Appointments",-1),ge={class:"card"},ye={class:"card-body"},Ue={class:"list-group"},we=e("br",null,null,-1),ke=e("br",null,null,-1),Ae=e("br",null,null,-1),De=e("br",null,null,-1),Se={key:0},Ie={key:1},Me={key:2},Ve=e("br",null,null,-1),qe=["onSubmit"],Ce=["onUpdate:modelValue"],Ne=e("button",{type:"submit",class:"btn btn-secondary mt-2"},"Submit",-1),Re={class:"d-flex flex-wrap"},Ee=["src"],je=["onClick"],Pe={__name:"UserProfile",setup(xe){const E=B(()=>r.value.map(a=>{const o=new Date(a.date)-new Date,l=Math.floor(o/(1e3*60)%60),c=Math.floor(o/(1e3*60*60)%24),u=Math.floor(o/(1e3*60*60*24));return{...a,timeUntil:{days:u,hours:c,minutes:l}}})),q=d([]),_=d(""),h=d(""),f=d(""),b=d(""),g=d(""),S=d(""),r=d([]),y=P({}),C=F();let U;const A=d(!0);Q(()=>C.currentUser,a=>{a?(U&&U(),U=Y(C,async s=>{if(A.value=!0,s){const t=D(k,"users",s.uid),o=await $(t);if(o.exists()){_.value=o.data().name||"",h.value=o.data().surname||"",f.value=o.data().age||"",b.value=o.data().email||"",g.value=o.data().city||"",S.value=o.data().uid||"";const l=z(O(k,"appointments"),H("userId","==",s.uid)),c=await W(l);r.value=c.docs.map(u=>({id:u.id,...u.data()})),console.log("Loaded appointments:",r.value);for(let u=0;u<r.value.length;u++)y[u]="";A.value=!1}else console.log("No such user!"),A.value=!1}})):U&&(U(),_.value="",h.value="",f.value="",b.value="",g.value="",S.value="",r.value=[],A.value=!1)},{immediate:!0});const j=async a=>{const s=r.value[a],t=D(k,"appointments",s.id);await G(t),r.value.splice(a,1)},x=async()=>{const a=D(k,"users",S.value);await R(a,{name:_.value,surname:h.value,age:f.value,email:b.value,city:g.value})},L=async()=>{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){console.log("Your browser does not support the MediaDevices API");return}const a={video:{facingMode:"user"},audio:!1},s=await navigator.mediaDevices.getUserMedia(a),t=document.createElement("video");t.srcObject=s,await t.play();const o=document.createElement("canvas");o.width=t.videoWidth,o.height=t.videoHeight,o.getContext("2d").drawImage(t,0,0);const l=o.toDataURL("image/jpeg");t.pause(),s.getTracks().forEach(c=>c.stop()),q.value.push(l)},T=async a=>{const s=r.value[a],t=D(k,"appointments",s.id);await R(t,{additionalInfo:J(y[a])}),y[a]=""};return(a,s)=>(n(),i("div",K,[e("div",X,[e("div",Z,[ee,e("div",te,[e("div",se,[e("div",oe,[e("img",{src:"https://firebasestorage.googleapis.com/v0/b/e-doctor-923d0.appspot.com/o/user.jpg?alt=media&token=891d1d12-6559-4edb-bd8b-4f8154ba088f",alt:"User Image",class:"img-fluid rounded-circle mb-3"},null,8,ae)]),e("form",{onSubmit:N(x,["prevent"])},[e("div",ne,[ie,p(e("input",{"onUpdate:modelValue":s[0]||(s[0]=t=>_.value=t),type:"text",class:"form-control",placeholder:"Name",required:""},null,512),[[v,_.value]])]),e("div",ce,[de,p(e("input",{"onUpdate:modelValue":s[1]||(s[1]=t=>h.value=t),type:"text",class:"form-control",placeholder:"Surname",required:""},null,512),[[v,h.value]])]),e("div",re,[ue,p(e("input",{"onUpdate:modelValue":s[2]||(s[2]=t=>f.value=t),type:"number",class:"form-control",placeholder:"Age",required:""},null,512),[[v,f.value]])]),e("div",me,[pe,p(e("input",{"onUpdate:modelValue":s[3]||(s[3]=t=>b.value=t),type:"email",class:"form-control",placeholder:"Email",required:""},null,512),[[v,b.value]])]),e("div",ve,[_e,p(e("input",{"onUpdate:modelValue":s[4]||(s[4]=t=>g.value=t),type:"text",class:"form-control",placeholder:"City",required:""},null,512),[[v,g.value]])]),he],40,le)])])]),e("div",fe,[be,e("div",ge,[e("div",ye,[e("ul",Ue,[(n(!0),i(I,null,M(E.value,(t,o)=>(n(),i("li",{key:o,class:"list-group-item"},[w(" Doctor: "+m(t.doctorName)+" "+m(t.doctorSurname)+" ",1),we,w(" Date: "+m(t.date)+" ",1),ke,Ae,w(" Localization: "+m(t.doctorLoc)+" ",1),De,w(" Time until appointment: "),t.timeUntil.days>0?(n(),i("span",Se,m(t.timeUntil.days)+" days ",1)):V("",!0),t.timeUntil.hours>0?(n(),i("span",Ie,m(t.timeUntil.hours)+" hours ",1)):V("",!0),t.timeUntil.minutes>0?(n(),i("span",Me,m(t.timeUntil.minutes)+" minutes ",1)):V("",!0),Ve,w(" Additional Info: "),e("ul",null,[(n(!0),i(I,null,M(t.additionalInfo,(l,c)=>(n(),i("li",{key:c},m(l),1))),128))]),e("form",{onSubmit:N(l=>T(o),["prevent"]),class:"mt-2"},[p(e("input",{"onUpdate:modelValue":l=>y[o]=l,class:"form-control",placeholder:"Add important information",required:""},null,8,Ce),[[v,y[o]]]),Ne],40,qe),e("button",{class:"btn btn-primary mt-2",onClick:L},"Add photos of injury"),e("div",Re,[(n(!0),i(I,null,M(q.value,(l,c)=>(n(),i("img",{key:c,src:l,width:"100",height:"100",class:"m-1"},null,8,Ee))),128))]),e("button",{class:"btn btn-danger mt-2",onClick:l=>j(o)},"Cancel Appointment",8,je)]))),128))])])])])])]))}};export{Pe as default};
